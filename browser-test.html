<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets API Browser Test</title>
</head>
<body>
    <h1>Testing Google Sheets API from Browser</h1>
    <div id="results"></div>
    
    <script>
        // This will test the API from the browser context (with proper referrer)
        async function testSheetsAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>üîç Testing Google Sheets API from browser...</p>';
            
            try {
                // Get API key from the React app's environment
                const API_KEY = 'AIzaSyBpeuxlQo_5n998cwlH-63wYjBAeBNnx50'; // Your API key
                const SHEET_ID = '1noZol3jQUF9EXHnatCHttRwmOgGN7S4Cavvrv9XyR8M';
                
                console.log('üîç Testing from browser with referrer:', window.location.origin);
                
                // Test metadata first
                const metadataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}?key=${API_KEY}`;
                console.log('üåê Requesting:', metadataUrl);
                
                const response = await fetch(metadataUrl);
                console.log('üìä Response status:', response.status, response.statusText);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Success! Metadata:', data);
                    
                    resultsDiv.innerHTML += '<p>‚úÖ Metadata retrieved successfully!</p>';
                    resultsDiv.innerHTML += `<p>üìë Available sheets: ${data.sheets?.map(s => s.properties.title).join(', ') || 'None'}</p>`;
                    
                    // Try to get actual data
                    const sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sheet1?key=${API_KEY}`;
                    const dataResponse = await fetch(sheetUrl);
                    
                    if (dataResponse.ok) {
                        const sheetData = await dataResponse.json();
                        console.log('‚úÖ Sheet data:', sheetData);
                        resultsDiv.innerHTML += `<p>üìä Data rows found: ${sheetData.values?.length || 0}</p>`;
                        resultsDiv.innerHTML += '<p>üéâ Your Google Sheets API is working perfectly!</p>';
                        
                        if (sheetData.values && sheetData.values.length > 0) {
                            resultsDiv.innerHTML += '<h3>First few rows:</h3>';
                            resultsDiv.innerHTML += '<pre>' + JSON.stringify(sheetData.values.slice(0, 5), null, 2) + '</pre>';
                        }
                    } else {
                        const errorText = await dataResponse.text();
                        console.error('‚ùå Data error:', errorText);
                        resultsDiv.innerHTML += `<p>‚ùå Data error: ${errorText}</p>`;
                    }
                    
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå Metadata error:', errorText);
                    resultsDiv.innerHTML += `<p>‚ùå Error: ${response.status} ${response.statusText}</p>`;
                    resultsDiv.innerHTML += `<pre>${errorText}</pre>`;
                }
                
            } catch (error) {
                console.error('üö® Unexpected error:', error);
                resultsDiv.innerHTML += `<p>üö® Unexpected error: ${error.message}</p>`;
            }
        }
        
        // Run test when page loads
        window.onload = testSheetsAPI;
    </script>
</body>
</html>
